import { normalizeImagePath } from 'rspress/runtime';

# ğŸ“º çŸ­å‰§è¯¦æƒ…

## ä»‹ç»

è¶Šæ¥è¶Šå¤šçš„å®¢æˆ·æœ‰è‡ªå®šä¹‰è¯¦æƒ…çš„éœ€æ±‚ï¼ŒåŒ…æ‹¬è§£é”å¼¹çª—ã€æ ‡é¢˜æ ã€åº•éƒ¨ä¿¡æ¯æ ã€é€‰é›†é¢æ¿ç­‰ï¼Œæ‰€ä»¥æ¨å‡ºäº†è¯¦æƒ…é¡µ Widget ç»„ä»¶ï¼Œæœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š

- å¯åµŒå…¥ä»»æ„ Flutter é¡µé¢
- å¯è¿›è¡Œé«˜åº¦è‡ªå®šä¹‰ UI å’Œé€»è¾‘
- é…åˆè·å–[çŸ­å‰§ä¿¡æ¯](/start/guide/adcontent/get)ï¼Œå¯å®Œå…¨ç”± Flutter å¼€å‘ä¸€å¥— 2 ç«¯éƒ½é€‚é…äº†(iOS å’Œ Android)

## ç¤ºä¾‹å›¾ç‰‡

> ä¸‹é¢å…¨æ˜¯çº¯ Flutter è‡ªå®šä¹‰é¡µé¢ï¼Œå¯é€šè¿‡ä½“éªŒç¤ºä¾‹åº”ç”¨

|è‡ªå®šä¹‰æ ‡é¢˜|è§£é”å¼¹çª—|æ¨èå‰§åœº|åˆ†ç±»æœç´¢|
|--|--|--|--|
| <img src={normalizeImagePath('/imgs/adcontent/img_detail_widget.webp')}/> | <img src={normalizeImagePath('/imgs/adcontent/img_detail_reward.webp')}/> | <img src={normalizeImagePath('/imgs/adcontent/img_theater_11.webp')}/>| <img src={normalizeImagePath('/imgs/adcontent/img_theater_12.webp')}/>| 

## çŸ­å‰§ç»„ä»¶

``` dart {19,24-25} title="example/pages/drama_detail.dart"
/// [controller] è§†é¢‘æ§åˆ¶å™¨
/// [unlockFlowListener] è§£é”æµç¨‹ç›‘å¬
/// [videoPlayListener] è§†é¢‘æ’­æ”¾ç›‘å¬å™¨
/// [width] View çš„å®½åº¦
/// [height] View çš„é«˜åº¦
/// [id] çŸ­å‰§ ID
/// [index] é›†æ•°
/// [groupId] åˆ†ç»„ ID
/// [detailFree] å…è´¹é›†æ•°
/// [unlockCount] è§£é”é›†æ•°
/// [hideTopInfo] æ˜¯å¦éšè—é¡¶éƒ¨ä¿¡æ¯
/// [setTopOffset] é¡¶éƒ¨ä¿¡æ¯åç§»
/// [hideBottomInfo] æ˜¯å¦éšè—åº•éƒ¨ä¿¡æ¯
/// [setBottomOffset] åº•éƒ¨ä¿¡æ¯åç§»
/// [hideRewardDialog] æ˜¯å¦éšè—å¥–åŠ±å¯¹è¯æ¡†
/// [hideMore] æ˜¯å¦éšè—æ›´å¤š
/// [hideCellularToast] æ˜¯å¦éšè—æµé‡æç¤º
DramaWidget(
    controller: [æ’­æ”¾æ§åˆ¶å™¨çœ‹ä¸‹é¢ğŸ‘‡],
    width: 375,
    height: 812,
    id: widget.drama.id,
    index: widget.drama.index,
    unlockFlowListener: [è§£é”æµç¨‹ç›‘å¬çœ‹ä¸‹é¢ğŸ‘‡],
    videoPlayListener: [æ’­æ”¾æµç¨‹ç›‘å¬çœ‹ä¸‹é¢ğŸ‘‡],
  ),
```

:::warning{title="ğŸ’¡ å°æç¤º"}

 - è¦ä½¿ç”¨ç»„ä»¶éœ€ä¿®æ”¹ Android å¯åŠ¨é¡µé¢ç»§æ‰¿ `FlutterFragmentActivity` 

``` java {2,4} title="example/android/app/src/main/java/com/zero/flutter_adcontent_example/MainActivity.java"
import io.flutter.embedding.android.FlutterActivity;
import io.flutter.embedding.android.FlutterFragmentActivity;

public class MainActivity extends FlutterFragmentActivity {
}
```
:::

## æ’­æ”¾æ§åˆ¶å™¨

``` dart {2,6,13}title="example/pages/drama_detail.dart"
/// åœ¨ initState ä¸­åˆå§‹åŒ–ï¼Œå¹¶ä¼ é€’ç»™ç»„ä»¶
late ProVideoController controller;

@override
void initState() {
  controller = ProVideoController();
}

@override
Widget build(BuildContext context) {
  return Scaffold(
      body: DramaWidget(
        controller: controller,
        ...
        )
  )
}
```

### æš‚åœ&ç»§ç»­
``` dart title="example/pages/drama_detail.dart"
controller.pause();
controller.resume();
```
### è®¾ç½®å½“å‰æ’­æ”¾é›†æ•°
``` dart title="example/pages/drama_detail.dart"
/// [index] é›†æ•°
controller.setCurrentIndex(currentIndex);
```
### æ‰“å¼€é€‰é›†é¢æ¿
``` dart title="example/pages/drama_detail.dart"
controller.openDramaGallery();
```
### æ‰“å¼€æ›´å¤šå¼¹çª—
``` dart title="example/pages/drama_detail.dart"
controller.openMoreDialog();
```
### è§£é”å‰§é›†
``` dart title="example/pages/drama_detail.dart"
/// [id] çŸ­å‰§ID
/// [lockSet] é”é›†æ•°
/// [cancel] æ˜¯å¦å–æ¶ˆ
controller.unLock(2324,2,false);
```


## è§£é”æµç¨‹ç›‘å¬

``` dart {4,10,12} title="example/pages/drama_detail.dart"
UnlockFlowListener(
      unlockFlowStart: (Drama drama) {
        // è§£é”æµç¨‹å¼€å§‹
        showUnlockDialog(drama);
      },
      unlockFlowEnd: (Drama drama, int? errCode, String? errMsg) {
        // è§£é”æµç¨‹ç»“æŸ
        print(
            'unlockFlowEnd: ${drama.title} errCode:$errCode errMsg:$errMsg');
        if (errCode != null) {
          // è§£é”å¤±è´¥ï¼Œè¿”å›ä¸Šä¸€é›†
          backIndex();
        } else {
          // è§£é”æˆåŠŸ
        }
      },
    )
```

### è§£é”å¼¹çª—è‡ªå®šä¹‰
``` dart {3,8,16} title="example/pages/drama_detail.dart"
/// è¿”å›ä¸Šä¸€é›†
void backIndex() {
  controller.setCurrentIndex(currentIndex);
}

/// è§£é”çŸ­å‰§
Future<void> unLockDrama(Drama drama, bool cancel) async {
  controller.unLock(drama.id, 2, cancel);
}

/// æ˜¾ç¤º Dialog
Future<void> showUnlockDialog(Drama drama) async {
  showDialog(
    context: context,
    barrierDismissible: false,
    builder: (context) => UnlockDialog(
      title: '${drama.title} ',
      indexText: 'ç¬¬${drama.index}é›†',
      unlockText: 'å…è´¹è§£é” 2 é›†',
      tipText: "è§£é”è¿˜èƒ½æé«˜çº¢åŒ…å¥–åŠ±å“¦~",
      onClose: () {
        Navigator.pop(context);
        unLockDrama(drama, true);
      },
      onUnlock: () {
        Navigator.pop(context);
        unLockDrama(drama, false);
      },
    ),
  );
}
```
## çŸ­å‰§æ’­æ”¾ç›‘å¬

``` dart {6-8,14} title="example/pages/drama_detail.dart"
VideoPlayListener(
      onDJXPageChange: (Drama drama) {
        // è§†é¢‘åˆ‡æ¢
        print(
            'VideoPlayListener onDJXPageChange: ${drama.id}:${drama.title}:${drama.index}');
        setState(() {
          newIndex = drama.index;
        });
      },
      onDJXVideoPlay: (Drama drama) {
        // è§†é¢‘æ’­æ”¾å¼€å§‹
        print(
            'VideoPlayListener onDJXVideoPlay: ${drama.id}:${drama.title}:${drama.index}');
        currentIndex = drama.index;
      },
      onDJXVideoPause: (Drama drama) {
        // è§†é¢‘æš‚åœ
        print(
            'VideoPlayListener onDJXVideoPause:  ${drama.id}:${drama.title}:${drama.index}');
      },
      onDJXVideoContinue: (Drama drama) {
        // è§†é¢‘ç»§ç»­
        print(
            'VideoPlayListener onDJXVideoContinue: ${drama.id}:${drama.title}:${drama.index}');
      },
      onDJXVideoCompletion: (Drama drama) {
        // è§†é¢‘æ’­æ”¾å®Œæˆ
        print(
            'VideoPlayListener onDJXVideoCompletion: ${drama.id}:${drama.title}:${drama.index}');
      },
      onDJXVideoOver: (Drama drama) {
        // è§†é¢‘ç»“æŸ
        print(
            'VideoPlayListener onDJXVideoOver: ${drama.id}:${drama.title}:${drama.index}');
      },
      onDJXVideoClose: () {
        // è§†é¢‘å…³é—­
        print('VideoPlayListener onDJXVideoClose');
      },
      onDJXSeekTo: (duration) {
        // æ‹–åŠ¨è¿›åº¦
        print("VideoPlayListener onDJXSeekTo:$duration");
      },
      onDurationChange: (duration) {
        // æ’­æ”¾è¿›åº¦
        print("VideoPlayListener onDurationChange:$duration");
      },
    )
```

### ç›‘å¬åœºæ™¯è¯´æ˜

``` dart {4-6,9-10} title="example/pages/drama_detail.dart"
VideoPlayListener(
      onDJXPageChange: (Drama drama) {
        // è§†é¢‘åˆ‡æ¢ï¼Œè¿™æ˜¯å½“å‰æœ€æ–°ä¸€é›†çŸ­å‰§ï¼Œç”¨äºæ¸²æŸ“é›†æ•°ç­‰ä¿¡æ¯ä½¿ç”¨
        setState(() {
          newIndex = drama.index;
        });
      },
      onDJXVideoPlay: (Drama drama) {
        // è§†é¢‘æ’­æ”¾å¼€å§‹ï¼Œæœªè§£é”çš„ä¸ä¼šè§¦å‘ï¼Œæ‰€ä»¥è¿™é‡Œç”¨äºè§£é”å¤±è´¥è¿”å›ä¸Šä¸€é›†çš„è®°å½•å€¼
        currentIndex = drama.index;
      },
    )
```